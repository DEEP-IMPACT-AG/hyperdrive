AWSTemplateFormatVersion: '2010-09-09'
Description: Test Hyperdrive certs
Parameters:
  HyperdriveCore:
    Type: String
    Default: HyperdriveCore
  FirstImpactIoHostedZone:
    Type: String
Resources:
  FirstImpactCert:
    Type: Custom::DnsCertificate
    Properties:
      ServiceToken:
        Fn::ImportValue:
          !Sub ${HyperdriveCore}-DnsCertificate
      DomainName: first-impact.io
      Region: us-east-1
      SubjectAlternativeNames:
      - test3-hyperdrive.first-impact.io
      Tags:
      - Key: hyperdrive:project
        Value: test
  OortCertRecordGroup:
    Type: AWS::Route53::RecordSetGroup
    Properties:
      HostedZoneId:
        Fn::ImportValue: !Sub ${FirstImpactIoHostedZone}-HostedZoneId
      RecordSets:
      - Name:
          Fn::GetAtt: [FirstImpactCert, "first-impact.io-RecordName"]
        ResourceRecords:
        - Fn::GetAtt: [FirstImpactCert, "first-impact.io-RecordValue"]
        TTL: "300"
        Type: CNAME
      - Name:
          Fn::GetAtt: [FirstImpactCert, "test3-hyperdrive.first-impact.io-RecordName"]
        ResourceRecords:
        - Fn::GetAtt: [FirstImpactCert, "test3-hyperdrive.first-impact.io-RecordValue"]
        TTL: "300"
        Type: CNAME
      - Name: "test3-hyperdrive.first-impact.io"
        ResourceRecords:
        - "0 issue \"amazon.com\""
        TTL: "300"
        Type: CAA
Outputs:
  FirstImpactCert:
    Value: !GetAtt FirstImpactCert.Arn
    Export:
      Name: !Sub ${AWS::StackName}-FirstImpactCert
